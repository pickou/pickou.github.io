<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>recurrent neural networks - Minerva</title>
    <meta name="author"  content="jcyan">
    <meta name="description" content="recurrent neural networks">
    <meta name="keywords"  content="rnn, lstm, DL">
    <!-- Open Graph -->
    <meta property="og:title" content="recurrent neural networks - Minerva">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://pickou.cn/blog/2017/12/11/rnn-networks.html">
    <meta property="og:description" content="Minerva is the goddess of wisdom in ancient Rome. Here for inpiration and idea spreading.">
    <meta property="og:site_name" content="Minerva">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
</head>
<body>
    <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
<input id="nm-switch" type="hidden" value="false">

<header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
        </ul>
    </nav>
</header>


<header class="g-banner post-header post-pattern-circuitBoard bgcolor-default post-no-cover" data-theme="default">
    <div class="post-wrapper">
        <div class="post-tags">
            
            
            <a href="http://pickou.cn/tags#rnn" class="post-tag">rnn</a>
            
            <a href="http://pickou.cn/tags#lstm" class="post-tag">lstm</a>
            
            <a href="http://pickou.cn/tags#DL" class="post-tag">DL</a>
            
            
        </div>
        <h1>recurrent neural networks</h1>
        <div class="post-meta">
            <span class="post-meta-item"><i class="iconfont icon-author"></i><a href="http://pickou.cn" target="_blank" rel="author">jcyan</a></></span>
            <time class="post-meta-item" datetime="17-12-11"><i class="iconfont icon-date"></i>11 Dec 2017</time>
        </div>
    </div>
    
</header>

<div class="post-content">
    <!-- mathjax -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        jax: ["input/Tex", "output/HTML-CSS"],
        text2jax: {
            inlineMath: [['$','$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$']],
            processEscape: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        },
        messageStyle: "none",
        "HTML-CSS": {preferredFont: "Tex", availableFonts: ["STIX", "TEX"]}
    });
    </script>   
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>   
   
    <article class="markdown-body">
        <p>Introduce basics knowledges about recurrent neural networks !</p>

<h2 id="1-rnn">1. RNN</h2>

<p>下图是一个RNN循环展开的示意图，<script type="math/tex">x_t</script>是t时刻的输入，<script type="math/tex">s_t</script>是隐藏单元,<script type="math/tex">s_t=f(Ux_t+Ws_{t-1})</script>，
激活函数f常用<code class="highlighter-rouge">tanh</code>和<code class="highlighter-rouge">RELU</code>.RNN的参数是共享的，即图中的<code class="highlighter-rouge">U</code>,<code class="highlighter-rouge">V</code>,<code class="highlighter-rouge">W</code>都是共享的参数.隐藏单元<code class="highlighter-rouge">s</code>是RNN的
feature所在，包含了一个序列的特征。RNN的训练采用<code class="highlighter-rouge">BPTT</code>算法进行反向传播。</p>

<p><img src="http://pickou.cn/pics/rnn/RNN.png" alt="RNN" /></p>

<h2 id="2-bptt">2. BPTT</h2>

<p>【1】 <code class="highlighter-rouge">forward</code> <script type="math/tex">s_t=f(Ux_t+Ws_{t-1})</script>以及<script type="math/tex">o_t = softmax(Vs_t)</script></p>

<p>【2】 <code class="highlighter-rouge">cross entropy</code> <script type="math/tex">E(y,\hat{y})=-\sum_t{y_tlog{\hat{y_t}}}</script></p>

<p>【3】 <code class="highlighter-rouge">backward</code> 目标是计算误差对于参数<code class="highlighter-rouge">U</code>,<code class="highlighter-rouge">V</code>和<code class="highlighter-rouge">W</code>的梯度。将每个时刻的梯度相加<script type="math/tex">\frac{dE}{dW}=\sum_t{\frac{dE_t}{dW}}</script> ,
 <script type="math/tex">\frac{dE}{dV}=\sum_t{\frac{dE_t}{dV}}</script> ,<script type="math/tex">\frac{dE}{dU}=\sum_t{\frac{dE_t}{dU}}</script> .<code class="highlighter-rouge">V</code>的梯度每个时刻是独立的，不依赖于别的时刻,
t时刻,<script type="math/tex">\frac{dE_t}{dV}=(\hat{y_t}-y_t)\otimes{s_t}</script>.计算W的梯度却不太一样，根据链式求导法则，</p>

<script type="math/tex; mode=display">\frac{dE_t}{dW}=\frac{dE_t}{d{\hat{y_t}}}\frac{d{\hat{y_t}}}{ds_t}\frac{ds_t}{dW}</script>

<p>又由于<script type="math/tex">s_t=f(Ux_t+Ws_{t-1})</script>,t时刻的输出依赖于t-1时刻，所以<script type="math/tex">s_{t-1}</script>也要使用链式求导法则，那么得到</p>

<script type="math/tex; mode=display">\frac{dE_t}{dW}=\sum_{k=0}^t\frac{dE_t}{d{\hat{y_t}}}\frac{d{\hat{y_t}}}{ds_t}\frac{ds_t}{ds_k}\frac{ds_k}{dW}</script>

<p>以下图为例，计算<script type="math/tex">s_3</script>的链式求导，<script type="math/tex">\frac{ds_3}{dz_2}=\frac{ds_3}{ds_2}\frac{ds_2}{ds_1}\frac{ds_1}{ds_0}</script>,其中<script type="math/tex">z_2=Ux_1+Ws_1</script></p>

<p><img src="http://pickou.cn/pics/rnn/bptt.png" alt="bptt" /></p>

<h2 id="3-lstm">3. LSTM</h2>

<p>一个标准的lstm内部结构如下图，包含四个单元</p>

<p><img src="http://pickou.cn/pics/rnn/lstm_example.png" alt="lstm" /></p>

<ul>
  <li><code class="highlighter-rouge">forget gate</code> 激活函数为sigmoid,输出为1，完全通过，输出为0，完全丢失。</li>
</ul>

<p><img src="http://pickou.cn/pics/rnn/which_to_forget.png" alt="forget_gate" /></p>

<ul>
  <li><code class="highlighter-rouge">存储单元</code> 通过<script type="math/tex">i_t</script>来选择是否让<script type="math/tex">\tilde{C_t}</script>加入到输出中</li>
</ul>

<p><img src="http://pickou.cn/pics/rnn/strore_cell.png" alt="strore_cell" /></p>

<ul>
  <li>接下来是<script type="math/tex">\tilde{C_t}</script>的输出</li>
</ul>

<p><img src="http://pickou.cn/pics/rnn/C_t.png" alt="C_t" /></p>

<ul>
  <li>以下面的几个公式来总结一下lstm，</li>
</ul>

<script type="math/tex; mode=display">\hat{h_t} = W_{hx}x_t+W_{hh}h_{t-1}\\
i_t = \sigma(W_{ix}x_t+W_{ih}h_{t-1})\\
o_t = \sigma(W_{ox}x_t+W_{oh}h_{t-1})\\
f_t = \sigma(W_{fx}x_t+W_{fh}h_{t-1})\\
c_t = f_t\odot{c_{t-1}}+i_t\odot{\hat{h_t}} \\
h_t = tanh(c_t\odot{o_t})</script>

<h2 id="4mlstm">4.mLSTM</h2>

<script type="math/tex; mode=display">m_t = (W_{mx}x_t)\odot(W_{mh}h_{t-1}) \\
\hat{h_t} = W_{hx}x_t+W_{hh}m_t \\
i_t = \sigma(W_{ix}x_t+W_{ih}m_t) \\
o_t = \sigma(W_{ox}x_t+W_{oh}m_t) \\
f_t = \sigma(W_{fx}x_t+W_{fh}m_t) \\</script>

<h2 id="references">References</h2>

<ul>
  <li><a href="http://colah.github.io/posts/2015-08-Understanding-LSTMs/">http://colah.github.io/posts/2015-08-Understanding-LSTMs/</a></li>
  <li><a href="http://www.cs.toronto.edu/%7Eilya/pubs/2011/LANG-RNN.pdf?ref=driverlayer.com">http://www.cs.toronto.edu/%7Eilya/pubs/2011/LANG-RNN.pdf?ref=driverlayer.com</a></li>
  <li><a href="https://arxiv.org/abs/1609.07959">https://arxiv.org/abs/1609.07959</a></li>
</ul>

    </article>
    
    <div class="social-share-wrapper">
        <div class="social-share"></div>
    </div>
    
</div>

<section class="author-detail">
    <section class="post-footer-item author-card">
        <div class="avatar">
            <img src="http://pickou.cn/assets/img/profile.png" alt="">
        </div>
        <div class="author-name" rel="author">jcyan</div>
        <div class="bio">
            <p>Lived it, love it!</p>
        </div>
        
        <ul class="sns-links">
            
            <li>
                <a href="//github.com/pickou" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
            </li>
            
            <li>
                <a href="//www.zhihu.com/people/jackyan-55/activities" target="_blank">
                    <i class="iconfont icon-zhihu"></i>
                </a>
            </li>
            
            <li>
                <a href="//www.linkedin.com/in/%E4%BF%8A%E8%B6%85-%E9%A2%9C-524914144/" target="_blank">
                    <i class="iconfont icon-linkedin"></i>
                </a>
            </li>
            
        </ul>
        
    </section>
    <section class="post-footer-item read-next">
        
        <div class="read-next-item">
            <a href="/blog/2017/12/11/gitlab-usage.html" class="read-next-link"></a>
            <section>
                <span>gitlab workflow</span>
                <p>gitlab作为一个协同工作的代码管理工具，使用起来很方便，能大大提高生产效率。git的工作流主要维护本地仓库的三...</p>
            </section>
            
        </div>
        
        
        <div class="read-next-item">
            <a href="/2017/12/11/recommender.html" class="read-next-link"></a>
            <section>
                <span>recommender system</span>
                <p>recommender system knwoledge</p>
            </section>
            
        </div>
        
    </section>
    
</section>

<footer class="g-footer">
    <section>Minerva © 2018</section>
    <section>Powered by <a href="//jekyllrb.com">Jekyll</a> </section>
</footer>


<script src="/assets/js/social-share.min.js"></script>
<script>
    socialShare('.social-share', {
        sites: ['wechat','weibo','douban','twitter'],
        wechatQrcodeTitle: "分享到微信朋友圈",
        wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
</script>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
/*写入自己的disqus信息*/
s.src = 'https://liaokeyu.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<script src="/assets/js/prism.js"></script>
<script src="/assets/js/index.min.js"></script>

<!--script src="http://pickou.cn/assets/js/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntil=configured" type="text/javascript"></script> -->

</body>
</html>
